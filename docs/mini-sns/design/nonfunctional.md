# 非機能要件（ISO/IEC 25010準拠）

## 1. 概要

本ドキュメントは、Mini-SNSの非機能要件をISO/IEC 25010品質モデルに基づき定義し、**すべて数値化**します。

## 2. Performance Efficiency（性能効率性）

### 2.1 応答時間

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| PE-01 | GET API応答時間（p95） | ≤ 200ms | CloudWatch Metrics |
| PE-02 | POST API応答時間（p95） | ≤ 500ms | CloudWatch Metrics |
| PE-03 | タイムライン取得（p95） | ≤ 250ms | CloudWatch Metrics |
| PE-04 | WebSocket接続確立時間（p95） | ≤ 1000ms | カスタムメトリクス |
| PE-05 | リアルタイム更新遅延（p95） | ≤ 3秒 | カスタムメトリクス（投稿作成→配信） |

### 2.2 スループット

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| PE-06 | 同時接続ユーザー数 | ≥ 1,000 | CloudWatch Metrics（WebSocket接続数） |
| PE-07 | リクエスト処理数 | ≥ 1,000 req/秒 | CloudWatch Metrics |
| PE-08 | 投稿作成スループット | ≥ 100 投稿/秒 | CloudWatch Metrics |

### 2.3 リソース効率

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| PE-09 | Lambda実行時間（平均） | ≤ 500ms | CloudWatch Logs Insights |
| PE-10 | Lambda メモリ使用率 | ≤ 80% | CloudWatch Metrics |
| PE-11 | DynamoDB RCU使用率（ピーク時） | ≤ 70% | CloudWatch Metrics |
| PE-12 | DynamoDB WCU使用率（ピーク時） | ≤ 70% | CloudWatch Metrics |

## 3. Reliability（信頼性）

### 3.1 可用性

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| RE-01 | システム稼働率（月間） | ≥ 99.5% | UptimeRobot |
| RE-02 | API可用性（月間） | ≥ 99.9% | CloudWatch Synthetics Canary |
| RE-03 | 平均故障間隔（MTBF） | ≥ 720時間（30日） | インシデント記録 |
| RE-04 | 平均復旧時間（MTTR） | ≤ 1時間 | インシデント記録 |

### 3.2 障害復旧

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| RE-05 | 目標復旧時点（RPO） | ≤ 5分 | DynamoDB PITR設定 |
| RE-06 | 目標復旧時間（RTO） | ≤ 1時間 | 復旧手順実行時間測定 |
| RE-07 | データ損失率 | = 0% | バックアップ検証 |

### 3.3 エラー率

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| RE-08 | API エラー率（4xx + 5xx） | ≤ 0.1% | CloudWatch Metrics |
| RE-09 | 5xx エラー率 | ≤ 0.05% | CloudWatch Metrics |
| RE-10 | イベント配信失敗率 | ≤ 0.1% | SQS DLQメッセージ数 |

## 4. Security（セキュリティ）

### 4.1 機密性

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| SE-01 | TLSバージョン | ≥ TLS 1.2 | API Gateway設定確認 |
| SE-02 | パスワードハッシュ強度 | bcrypt cost factor ≥ 10 | Cognito設定確認 |
| SE-03 | DynamoDB暗号化 | 100%（保存時暗号化） | DynamoDB設定確認 |
| SE-04 | JWTトークン有効期間 | ≤ 1時間 | Cognito設定確認 |

### 4.2 完全性

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| SE-05 | SQLインジェクション対策率 | 100%（N/A: NoSQL使用） | コードレビュー |
| SE-06 | XSS対策率 | 100%（入力サニタイゼーション） | セキュリティスキャン |
| SE-07 | CSRF対策率 | 100%（トークン検証） | セキュリティスキャン |

### 4.3 認証・認可

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| SE-08 | 認証必須エンドポイント率 | 100%（公開API除く） | OpenAPI仕様確認 |
| SE-09 | セッションタイムアウト | = 24時間（無操作時） | Cognito設定確認 |
| SE-10 | パスワード最小文字数 | ≥ 8文字 | Cognito設定確認 |

### 4.4 レート制限

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| SE-11 | API レート制限 | 100 req/秒/ユーザー | API Gateway設定確認 |
| SE-12 | 投稿作成レート制限 | 10 投稿/分/ユーザー | Lambda内ロジック確認 |
| SE-13 | WebSocket メッセージレート制限 | 100 msg/秒/接続 | Lambda内ロジック確認 |

## 5. Usability（使用性）

### 5.1 ユーザー満足度

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| US-01 | アカウント登録完了率 | ≥ 80% | Google Analytics |
| US-02 | タスク完了時間（投稿作成） | ≤ 30秒（平均） | ユーザーテスト |
| US-03 | エラーメッセージ理解度 | ≥ 90% | ユーザーアンケート |

### 5.2 アクセシビリティ

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| US-04 | WCAG 2.1 レベルAA準拠率 | ≥ 90% | Lighthouse Accessibility Score |
| US-05 | キーボードナビゲーション対応率 | 100%（主要機能） | 手動テスト |
| US-06 | タップ可能領域最小サイズ | ≥ 44x44px | デザインレビュー |

## 6. Maintainability（保守性）

### 6.1 コード品質

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| MA-01 | コードカバレッジ（単体テスト） | ≥ 80% | Jest/Pytest カバレッジ |
| MA-02 | 循環的複雑度（関数平均） | ≤ 10 | SonarQube |
| MA-03 | 技術的負債比率 | ≤ 5% | SonarQube |
| MA-04 | コードレビュー実施率 | 100% | GitHub PR設定 |

### 6.2 モニタリング

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| MA-05 | ログ構造化率 | 100%（JSON形式） | CloudWatch Logs確認 |
| MA-06 | 分散トレーシング有効率 | 100%（全Lambda） | X-Ray設定確認 |
| MA-07 | アラート対応時間（平均） | ≤ 15分 | インシデント記録 |

## 7. Portability（移植性）

### 7.1 ブラウザ対応

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| PO-01 | Chrome対応 | 最新版 + 1つ前のバージョン | クロスブラウザテスト |
| PO-02 | Firefox対応 | 最新版 + 1つ前のバージョン | クロスブラウザテスト |
| PO-03 | Safari対応 | 最新版 + 1つ前のバージョン | クロスブラウザテスト |
| PO-04 | iOS Safari対応 | 最新2バージョン | モバイルテスト |
| PO-05 | Android Chrome対応 | 最新2バージョン | モバイルテスト |

### 7.2 画面サイズ対応

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| PO-06 | 最小画面幅 | 320px | レスポンシブテスト |
| PO-07 | 最大画面幅 | 1920px | レスポンシブテスト |
| PO-08 | ブレークポイント | 320px, 768px, 1024px, 1920px | デザイン仕様確認 |

## 8. Compatibility（互換性）

### 8.1 API互換性

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| CO-01 | 後方互換性維持期間 | ≥ 6ヶ月 | バージョニングポリシー |
| CO-02 | API バージョン管理 | セマンティックバージョニング | OpenAPI仕様確認 |
| CO-03 | 廃止予告期間 | ≥ 3ヶ月 | API ドキュメント |

## 9. Scalability（スケーラビリティ）

### 9.1 水平スケーリング

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| SC-01 | Lambda同時実行数上限 | ≥ 1,000 | Lambda設定確認 |
| SC-02 | DynamoDBオートスケーリング | 有効（オンデマンドモード） | DynamoDB設定確認 |
| SC-03 | WebSocket接続数上限 | ≥ 1,000 | API Gateway設定確認 |

### 9.2 容量計画

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| SC-04 | 想定ユーザー数（ピーク時） | 1,000 | 負荷テスト |
| SC-05 | 想定投稿数 | 5,000 件/日 | 負荷テスト |
| SC-06 | Redisメモリ使用量（ピーク時） | ≤ 1GB | CloudWatch Metrics |

## 10. Observability（観測性）

### 10.1 ログ

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| OB-01 | ログ保持期間 | 30日 | CloudWatch Logs設定 |
| OB-02 | ログレベル（本番） | INFO以上 | Lambda環境変数 |
| OB-03 | エラーログ取得率 | 100% | Sentry設定確認 |

### 10.2 メトリクス

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| OB-04 | メトリクス収集間隔 | 1分 | CloudWatch設定 |
| OB-05 | カスタムメトリクス数 | ≥ 20個 | CloudWatch Metrics確認 |
| OB-06 | ダッシュボード更新頻度 | リアルタイム（30秒） | CloudWatch Dashboard |

### 10.3 アラート

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| OB-07 | アラート通知遅延 | ≤ 1分 | CloudWatch Alarms設定 |
| OB-08 | Critical アラート対応時間 | ≤ 15分 | インシデント記録 |
| OB-09 | Warning アラート対応時間 | ≤ 1時間 | インシデント記録 |

## 11. Cost Efficiency（コスト効率性）

### 11.1 運用コスト

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| CE-01 | 月額運用コスト（本番） | ≤ $100 | AWS Cost Explorer |
| CE-02 | 月額運用コスト（開発） | ≤ $20 | AWS Cost Explorer |
| CE-03 | ユーザーあたりコスト | ≤ $0.10/月 | AWS Cost Explorer |

### 11.2 コスト最適化

| ID | 要件 | 目標値 | 測定方法 |
|----|------|--------|---------|
| CE-04 | Lambda メモリ最適化実施率 | 100% | Lambda設定レビュー |
| CE-05 | DynamoDB Reserved Capacity使用率 | ≥ 50%（安定後） | DynamoDB設定確認 |
| CE-06 | 未使用リソース削減率 | 100% | AWS Trusted Advisor |

## 12. 測定・監視計画

### 12.1 日次監視

- API応答時間（p95, p99）
- エラー率（4xx, 5xx）
- Lambda実行時間・エラー数
- DynamoDB スロットリング数
- WebSocket接続数・切断率

### 12.2 週次レビュー

- コストトレンド分析
- パフォーマンストレンド分析
- セキュリティスキャン結果
- ユーザーフィードバック分析

### 12.3 月次評価

- SLA達成率レポート
- 容量計画見直し
- 技術的負債評価
- インシデント振り返り

## 13. 参考資料

- [ISO/IEC 25010 Software Quality Model](https://iso25000.com/index.php/en/iso-25000-standards/iso-25010)
- [AWS Well-Architected Framework](https://aws.amazon.com/architecture/well-architected/)
- [SRE Book - Service Level Objectives](https://sre.google/sre-book/service-level-objectives/)
